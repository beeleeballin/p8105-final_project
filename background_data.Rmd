---
title: "Looking at the numbers"
output: 
  html_document:
    toc: true
    toc_float: true
    code_folding: hide
---

## Data Sources

For weather data...

For outcomes data, we are interested in the incidence of asthma, skin cancer and
lung cancer across time and space. We obtained age-adjusted incidence rates data 
for these three health outcomes for the U.S. states New York, Ohio and 
Pennsylvania over multiple years. The following bullet points provide links from 
where we obtained the data.

*   Asthma
    *   Provide source
*   Melanoma of the skin (skin cancer)
    *   [New York](https://www.health.ny.gov/statistics/cancer/registry/table2/tb2melanomanys.htm)
    *   [Ohio](https://publicapps.odh.ohio.gov/EDW/DataBrowser/Browse/StateLayoutLockdownCancers)
    *   [Pennsylvania](https://www.phaim1.health.pa.gov/EDD/)
*   Lung cancer
    *   [New York](https://www.health.ny.gov/statistics/cancer/registry/table2/tb2lungnys.htm)
    *   [Ohio](https://publicapps.odh.ohio.gov/EDW/DataBrowser/Browse/StateLayoutLockdownCancers)
    *   [Pennsylvania](https://www.phaim1.health.pa.gov/EDD/)

We also obtained age-adjusted incidence rates data for these three health
outcomes for the U.S. states New York, Ohio and Pennsylvania at the county-level
at fixed time points. The following bullet points provide links from 
where we obtained the data. The asthma data is provided for the year 2016 and
the skin cancer and lunger cancer data is average over the years 2014-2018.

*   Asthma
    *   Provide source
*   Melanoma of the skin (skin cancer) and lung cancer
    *   [All 50 states](https://statecancerprofiles.cancer.gov/quick-profiles/index.php?tabSelected=2&statename=newyork)

Each of these data sets were exported and each imported into R. For each
of the three health outcomes, the data sets were merged across the three states 
for the longitudinal data and for the cross-sectional data. This effort resulted in six 
data sets. The data import and cleaning of the original data can be found in the 
data import folder on our github repository.

We will now import the six data sets and merge all longitudinal data together
and merge all cross-sectional data together to have two data sets.

```{r setup, include=FALSE}

library(tidyverse)
library(dplyr)
library(usmap)
library(ggplot2)
library(maps)
library(mapdata)
library(plotly)
library(rjson)

url <- 'https://raw.githubusercontent.com/plotly/datasets/master/geojson-counties-fips.json'
counties <- rjson::fromJSON(file = url)


state_lc_wide = read_csv("./data/state_lc_wide.csv")

# plotly of county level data

fig <- plot_ly(state_lc_wide, x = ~year)
fig <- fig %>% add_lines(y = ~PA_AAIR, name = "Pennsylvania")
fig <- fig %>% add_lines(y = ~NY_AAIR, name = "New York")
fig <- fig %>% add_lines(y = ~OH_AAIR, name = "Ohio")
fig <- fig %>% layout(
    title = "Lung Cancer Age-Adjusted Incidence Rates",
    xaxis = list(
      rangeselector = list(
        buttons = list(
          list(
            count = 1,
            label = "1 yr",
            step = "year",
            stepmode = "backward"),
          list(
            count = 5,
            label = "5 yr",
            step = "year",
            stepmode = "backward"),
          list(
            count = 10,
            label = "10 yr",
            step = "year",
            stepmode = "backward"),
          list(step = "all"))),

      rangeslider = list(type = "year")),

    yaxis = list(title = "Age-Adjusted Incidence Rate (per 100,000"))

fig

lc_aqi_data = read_csv("./data/lc_aqi_data.csv")

fig1 <- lc_aqi_data %>%
  plot_ly(
    x = ~age_adjusted_incidence,
    y = ~y,
    frame = ~f,
    type = 'scatter',
    mode = 'markers',
    showlegend = F
  )

fig1 <- lc_aqi_data %>%
  plot_ly(
    x = ~avg_med_aqi, 
    y = ~age_adjusted_incidence_rate, 
    color = ~state, 
    frame = ~year, 
    text = ~state, 
    hoverinfo = "text",
    type = 'scatter',
    mode = 'markers'
  )
fig1 <- fig1 %>% layout(
  title = "Lung Cancer AAIR and Average Median AQI",
    xaxis = list(title = "Average Median AQI", 
      type = "log"
    ),
    yaxis = list(title = "Age Adjusted Incidence Rate")
  )


fig1

lc_fips = read_csv("./data/lung/lc_fips.csv")


county_map_lc <- plot_ly()
county_map_lc <- county_map_lc %>%
  add_trace(
    type = "choroplethmapbox",
    geojson = counties,
    locations = lc_fips$fips,
    z = lc_fips$age_adjusted_incidence_rate,
    text = lc_fips$county,
    colorscale = "Viridis",
    reversescale = TRUE,
    marker = list(line = list(
      width = 0),
      opacity = 0.5)
    )
county_map_lc <- county_map_lc %>%
  layout(
    title = "Age-Adjusted Lung Cancer Incidence Rates (2014-2018)",
    mapbox = list(
      style = "carto-positron",
      zoom = 4,
      center = list(lon = -77.215135, lat = 41.164818)
    )
  )


county_map_lc


state_melanoma_age_adjusted = read_csv("./data/incidence_melanoma_data/state_melanoma_age_adjusted.csv")

state_mel_plot = state_melanoma_age_adjusted %>%
  ggplot(aes(x = year, y = age_adjusted_incidence_rate, color = state)) +
  geom_line() +
  labs(
    title = "Age-adjusted incidence rate of Melanoma by Year colored by State",
    x = "Year",
    y = "Age-adjusted incidence rate of Melanoma", 
    color = "State"
  ) +
  scale_x_continuous(breaks = seq(1976, 2018, by = 4)) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))



```



## Let's talk health outcomes:

To discuss how climate change has impacted the rate of certain negative health
outcomes, let's first assess their general prevalence.


# Recent County-Level Trends


Clearly, according to the map below, lung cancer is a relevant issue in 
our three states of interest (NY, PA, and OH). They also provide a good
range of examples, as we can see multiple counties with high age-adjusted 
incidence rates in Ohio, a few in New York, and virtually none in Pennsylvania.


```{r}

# plotly of county level data

county_map_lc

```


# Recent State Level Trends

We can also check how these rates have changed by state over time:



```{r}

# plotly of county level data

fig

state_mel_plot


```






